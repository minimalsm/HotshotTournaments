<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"
      defer
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"
      integrity="sha384-LtrjvnR4Twt/qOuYxE721u19sVFLVSA4hf/rRt6PrZTmiPltdZcI7q7PXQBYTKyf"
      crossorigin="anonymous"
      defer
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <title>Hotshot Tournaments</title>
  </head>
  <body>
    <div class="container-xl">
      <h1 class="text-center">My Tournaments</h1>
      <hr />

      <div
        class="tournaments d-flex justify-content-around align-items-center"
      ></div>
      <button id="btn-log-out" class="btn btn-danger">Sign Out</button>
    </div>
  </body>
  <script>
    window.onload = async () => {
      const userToken = localStorage.getItem("token");
      if (!userToken) {
        return window.location.replace("./login.html");
      } else {
        //verify that this is a valid users token
        fetch("http://localhost:8000/api/auth/authUserToken", {
          headers: {
            accessToken: userToken
          }
        })
          .then((res) => {
            if (!res.ok) {
              return window.location.replace("./login.html");
            }
          })
          .catch((error) => console.error(error));
      }

      //TOKEN HAS BEEN VALIDATED, now getting all the tournaments
      const tournamentsSection = document.querySelector(".tournaments");

      fetch("http://localhost:8000/api/tournaments/myTournaments", {
        headers: {
          accessToken: userToken
        }
      }).then(async (res) => {
        if (!res.ok) {
          const message = await res.json();
          console.error(message);
        } else {
          const tournaments = await res.json();
          console.log(tournaments);
          renderTournaments(tournaments);
        }
      });

      function renderTournaments(tournaments) {
        const tournamentsDiv = document.querySelector(".tournaments");

        tournaments.forEach((tournament) => {
          const tournamentDiv = `<div class="card" style="width: 18rem">
          <img
            class="card-img-top"
            style="height: 100px; background-color: lightgrey"
            src="..."
            alt="Card image cap"
          />
          <div class="card-body">
            <h5 class="card-title">
              ${tournament.name}
              <span class="badge-primary badge-pill small">${
                tournament.game
              }</span>
            </h5>
            <p class="card-text">
              ${tournament.description}
            </p>
            <p class="card-text">
              <b>Start Date: </b> ${new Date(
                tournament.startDate
              ).toDateString()}
            </p>
            <p class="card-text">
              <b>End Date: </b> ${new Date(tournament.endDate).toDateString()}
            </p>
          </div>`;
          tournamentsDiv.innerHTML += tournamentDiv;
        });
      }

      const btnLogOut = document.querySelector("#btn-log-out");

      btnLogOut.addEventListener("click", async (e) => {
        localStorage.setItem("token", "logged out");
        window.location.replace("./login.html");
      });
    };
  </script>
</html>
